import {
  DisclosurePanel,
  Disclosure,
  MenuButton,
  Menu,
  DisclosureButton,
  MenuItems,
  MenuItem,
} from "@headlessui/react";

import {  XMarkIcon } from "@heroicons/react/24/outline";
import { Link, useNavigate } from "react-router-dom";
import { signOut } from "firebase/auth";
import { auth } from "../../firebase/firebase";
import { useEffect, useState } from "react";

const Navbar = ({ active, userId }) => {
  const navigate = useNavigate();

  const [navigation, setNavigation] = useState([]);

  useEffect(() => {
    console.log("from Navbar", userId);
    setNavigation([
      {
        name: "Home",
        href: `/`,
        current: active === "",
      },
      {
        name: "Pré-visualização",
        href: `/previewext/${userId}`,
        current: active === "preview",
      },
      {
        name: "Gerar QR",
        href: `/qr`,
        current: active === "qr",
      },
    ]);
  }, [userId, active]);

  const handleSignOut = async () => {
    await signOut(auth);
    localStorage.removeItem("userID");
   
    navigate("/login");
  };

  function classNames(...classes) {
    return classes.filter(Boolean).join(" ");
  }
  // console.log(userId);
  return (
    <Disclosure
      as="nav"
      className="bg-bgGreen sticky top-0 z-50 text-textWhite"
    >
      <div className="mx-auto max-w-7xl sm:px-4 lg:px-8 ">
        <div className="relative flex h-16 items-center justify-between ">
          {/* Mobile menu button */}
          <div className="absolute inset-y-0 left-0 flex items-center sm:hidden">
            <DisclosureButton className="inline-flex items-center justify-center p-2 text-textWhite hover:bg-gray-700 hover:text-white focus:outline-none">
              <svg
                width="465"
                height="85"
                viewBox="0 0 465 85"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="w-[200px]"
              >
                <g id="Group 1">
                  <path
                    id="Geramenu"
                    d="M143.652 75.7363C140.978 75.7363 138.532 75.3301 136.314 74.5176C134.097 73.7051 132.193 72.4694 130.602 70.8105C129.01 69.1348 127.792 67.0612 126.945 64.5898C126.099 62.1185 125.676 59.2747 125.676 56.0586C125.676 53.0117 126.099 50.2865 126.945 47.8828C127.809 45.4622 129.036 43.3971 130.627 41.6875C132.167 40.0286 134.063 38.7507 136.314 37.8535C138.566 36.9564 141.029 36.5078 143.703 36.5078C144.973 36.5078 146.191 36.6009 147.359 36.7871C148.527 36.9733 149.645 37.2272 150.711 37.5488C151.557 37.8027 152.497 38.1582 153.529 38.6152C154.579 39.0553 155.425 39.4362 156.068 39.7578V45.8262H155.637C155.01 45.2676 154.359 44.7428 153.682 44.252C153.021 43.7441 152.082 43.2025 150.863 42.627C149.848 42.1191 148.68 41.696 147.359 41.3574C146.039 41.0189 144.617 40.8496 143.094 40.8496C139.454 40.8496 136.509 42.2207 134.258 44.9629C132.023 47.7051 130.906 51.3529 130.906 55.9062C130.906 58.4453 131.202 60.6628 131.795 62.5586C132.387 64.4544 133.242 66.0625 134.359 67.3828C135.443 68.6862 136.746 69.6849 138.27 70.3789C139.81 71.056 141.536 71.3945 143.449 71.3945C144.871 71.3945 146.285 71.293 147.689 71.0898C149.094 70.8867 150.279 70.582 151.244 70.1758V60.4004H142.51V55.9824H156.221V72.4863C155.577 72.7741 154.714 73.138 153.631 73.5781C152.564 74.0182 151.566 74.3652 150.635 74.6191C149.399 74.9915 148.282 75.2708 147.283 75.457C146.285 75.6432 145.074 75.7363 143.652 75.7363ZM174.502 75.6602C169.982 75.6602 166.47 74.3906 163.965 71.8516C161.477 69.2956 160.232 65.6732 160.232 60.9844C160.232 56.3633 161.443 52.6901 163.863 49.9648C166.284 47.2227 169.449 45.8516 173.359 45.8516C175.12 45.8516 176.677 46.1055 178.031 46.6133C179.385 47.1211 180.57 47.9167 181.586 49C182.602 50.0833 183.38 51.4121 183.922 52.9863C184.464 54.5436 184.734 56.4564 184.734 58.7246V61.3145H165.082C165.082 64.6152 165.911 67.1374 167.57 68.8809C169.229 70.6243 171.523 71.4961 174.451 71.4961C175.501 71.4961 176.525 71.3776 177.523 71.1406C178.539 70.9036 179.453 70.599 180.266 70.2266C181.129 69.8372 181.857 69.4648 182.449 69.1094C183.042 68.737 183.533 68.39 183.922 68.0684H184.201V73.2734C183.643 73.4935 182.949 73.7728 182.119 74.1113C181.29 74.4329 180.545 74.6868 179.885 74.873C178.954 75.127 178.107 75.3216 177.346 75.457C176.601 75.5924 175.653 75.6602 174.502 75.6602ZM180.088 57.6582C180.054 56.3717 179.902 55.263 179.631 54.332C179.36 53.401 178.971 52.6139 178.463 51.9707C177.904 51.2598 177.185 50.7181 176.305 50.3457C175.441 49.9733 174.367 49.7871 173.08 49.7871C171.811 49.7871 170.727 49.9818 169.83 50.3711C168.95 50.7435 168.146 51.2936 167.418 52.0215C166.707 52.7663 166.165 53.5957 165.793 54.5098C165.421 55.4069 165.184 56.4564 165.082 57.6582H180.088ZM204.59 51.7676H204.336C203.98 51.666 203.6 51.6068 203.193 51.5898C202.804 51.556 202.33 51.5391 201.771 51.5391C200.485 51.5391 199.207 51.8184 197.938 52.377C196.668 52.9355 195.466 53.765 194.332 54.8652V75H189.559V46.6387H194.332V50.8535C196.076 49.3132 197.59 48.2298 198.877 47.6035C200.18 46.9603 201.441 46.6387 202.66 46.6387C203.151 46.6387 203.515 46.6556 203.752 46.6895C204.006 46.7064 204.285 46.7402 204.59 46.791V51.7676ZM224.141 68.0176V60.1465C223.007 60.248 221.568 60.3919 219.824 60.5781C218.098 60.7474 216.701 60.9928 215.635 61.3145C214.365 61.7038 213.316 62.3047 212.486 63.1172C211.657 63.9128 211.242 65.0299 211.242 66.4688C211.242 68.0938 211.699 69.321 212.613 70.1504C213.527 70.9798 214.865 71.3945 216.625 71.3945C218.132 71.3945 219.494 71.0729 220.713 70.4297C221.932 69.7695 223.074 68.9655 224.141 68.0176ZM224.141 71.9785C223.751 72.2663 223.227 72.6725 222.566 73.1973C221.923 73.7051 221.297 74.1113 220.688 74.416C219.841 74.8561 219.02 75.1947 218.225 75.4316C217.446 75.6686 216.346 75.7871 214.924 75.7871C213.756 75.7871 212.647 75.5671 211.598 75.127C210.548 74.6868 209.626 74.069 208.83 73.2734C208.068 72.4948 207.459 71.5384 207.002 70.4043C206.545 69.2533 206.316 68.043 206.316 66.7734C206.316 64.8099 206.731 63.1426 207.561 61.7715C208.39 60.3835 209.702 59.2832 211.496 58.4707C213.087 57.7428 214.966 57.2435 217.133 56.9727C219.299 56.6849 221.635 56.4733 224.141 56.3379V55.4238C224.141 54.3066 223.971 53.4095 223.633 52.7324C223.294 52.0384 222.82 51.5052 222.211 51.1328C221.602 50.7435 220.857 50.4896 219.977 50.3711C219.096 50.2357 218.191 50.168 217.26 50.168C216.16 50.168 214.865 50.3372 213.375 50.6758C211.885 50.9974 210.396 51.4714 208.906 52.0977H208.627V47.248C209.507 46.9941 210.768 46.7148 212.41 46.4102C214.052 46.1055 215.677 45.9531 217.285 45.9531C219.232 45.9531 220.874 46.1055 222.211 46.4102C223.548 46.7148 224.75 47.265 225.816 48.0605C226.849 48.8392 227.619 49.8464 228.127 51.082C228.635 52.3177 228.889 53.8242 228.889 55.6016V75H224.141V71.9785ZM267.812 75V58.5977C267.812 57.2943 267.762 56.0924 267.66 54.9922C267.559 53.875 267.347 53.0033 267.025 52.377C266.687 51.6999 266.204 51.2005 265.578 50.8789C264.952 50.5573 264.105 50.3965 263.039 50.3965C262.057 50.3965 260.999 50.7012 259.865 51.3105C258.748 51.903 257.589 52.7663 256.387 53.9004C256.404 54.1882 256.421 54.5352 256.438 54.9414C256.471 55.3307 256.488 55.7962 256.488 56.3379V75H251.715V58.5977C251.715 57.2943 251.664 56.0924 251.562 54.9922C251.461 53.875 251.249 53.0033 250.928 52.377C250.589 51.6999 250.107 51.2005 249.48 50.8789C248.854 50.5573 248.008 50.3965 246.941 50.3965C245.909 50.3965 244.826 50.7181 243.691 51.3613C242.557 52.0046 241.457 52.8255 240.391 53.8242V75H235.617V46.6387H240.391V49.7871C241.643 48.5345 242.879 47.5697 244.098 46.8926C245.333 46.1986 246.688 45.8516 248.16 45.8516C249.836 45.8516 251.317 46.2324 252.604 46.9941C253.907 47.7559 254.897 49.0085 255.574 50.752C257.013 49.1439 258.418 47.9251 259.789 47.0957C261.16 46.2663 262.65 45.8516 264.258 45.8516C265.477 45.8516 266.585 46.0462 267.584 46.4355C268.583 46.8079 269.454 47.4173 270.199 48.2637C270.961 49.127 271.545 50.2018 271.951 51.4883C272.374 52.7747 272.586 54.3913 272.586 56.3379V75H267.812ZM291.604 75.6602C287.084 75.6602 283.572 74.3906 281.066 71.8516C278.578 69.2956 277.334 65.6732 277.334 60.9844C277.334 56.3633 278.544 52.6901 280.965 49.9648C283.385 47.2227 286.551 45.8516 290.461 45.8516C292.221 45.8516 293.779 46.1055 295.133 46.6133C296.487 47.1211 297.672 47.9167 298.688 49C299.703 50.0833 300.482 51.4121 301.023 52.9863C301.565 54.5436 301.836 56.4564 301.836 58.7246V61.3145H282.184C282.184 64.6152 283.013 67.1374 284.672 68.8809C286.331 70.6243 288.624 71.4961 291.553 71.4961C292.602 71.4961 293.626 71.3776 294.625 71.1406C295.641 70.9036 296.555 70.599 297.367 70.2266C298.23 69.8372 298.958 69.4648 299.551 69.1094C300.143 68.737 300.634 68.39 301.023 68.0684H301.303V73.2734C300.744 73.4935 300.05 73.7728 299.221 74.1113C298.391 74.4329 297.646 74.6868 296.986 74.873C296.055 75.127 295.209 75.3216 294.447 75.457C293.702 75.5924 292.755 75.6602 291.604 75.6602ZM297.189 57.6582C297.156 56.3717 297.003 55.263 296.732 54.332C296.462 53.401 296.072 52.6139 295.564 51.9707C295.006 51.2598 294.286 50.7181 293.406 50.3457C292.543 49.9733 291.468 49.7871 290.182 49.7871C288.912 49.7871 287.829 49.9818 286.932 50.3711C286.051 50.7435 285.247 51.2936 284.52 52.0215C283.809 52.7663 283.267 53.5957 282.895 54.5098C282.522 55.4069 282.285 56.4564 282.184 57.6582H297.189ZM328.953 75H324.18V58.8516C324.18 57.5482 324.112 56.3379 323.977 55.2207C323.858 54.0866 323.621 53.181 323.266 52.5039C322.876 51.793 322.335 51.2682 321.641 50.9297C320.947 50.5742 319.999 50.3965 318.797 50.3965C317.612 50.3965 316.385 50.7181 315.115 51.3613C313.863 51.9876 312.635 52.8086 311.434 53.8242V75H306.66V46.6387H311.434V49.7871C312.855 48.5176 314.26 47.5443 315.648 46.8672C317.036 46.1901 318.501 45.8516 320.041 45.8516C322.834 45.8516 325.018 46.7741 326.592 48.6191C328.166 50.4473 328.953 53.1048 328.953 56.5918V75ZM357.746 75H352.973V71.8516C351.5 73.138 350.104 74.1198 348.783 74.7969C347.463 75.457 345.99 75.7871 344.365 75.7871C343.13 75.7871 341.962 75.584 340.861 75.1777C339.778 74.7715 338.83 74.1283 338.018 73.248C337.205 72.3678 336.57 71.2591 336.113 69.9219C335.673 68.5846 335.453 66.9596 335.453 65.0469V46.6387H340.227V62.7871C340.227 64.2936 340.277 65.5462 340.379 66.5449C340.497 67.5267 340.751 68.39 341.141 69.1348C341.53 69.8626 342.055 70.3958 342.715 70.7344C343.392 71.0729 344.357 71.2422 345.609 71.2422C346.777 71.2422 348.021 70.9121 349.342 70.252C350.662 69.5918 351.872 68.7793 352.973 67.8145V46.6387H357.746V75Z"
                    fill="#CCD5AE"
                  />
                  <g id="Fork Spoon" clipPath="url(#clip0_1_14)">
                    <path
                      id="icon"
                      d="M69.5067 25.7373L70.2766 26.2309V25.3164V4.03611C70.2766 3.05232 70.5722 2.18141 71.0259 1.56817C71.4796 0.954816 72.0663 0.625397 72.6695 0.625397C73.2726 0.625397 73.8593 0.954814 74.313 1.56817C74.7667 2.18141 75.0623 3.05232 75.0623 4.03611V25.3164V26.231L75.8322 25.7372C76.5857 25.254 77.2653 24.6044 77.8444 23.8215C78.5081 22.9243 79.0295 21.8663 79.3837 20.7103L79.3837 20.7103C79.7379 19.5541 79.9195 18.318 79.9195 17.0718V4.03611C79.9195 3.05232 80.2151 2.18141 80.6687 1.56817C81.1224 0.954816 81.7091 0.625397 82.3123 0.625397C82.9155 0.625397 83.5022 0.954814 83.9559 1.56817C84.4095 2.18141 84.7052 3.05232 84.7052 4.03611V17.0718C84.7052 19.2493 84.3878 21.4035 83.7729 23.4105C83.1579 25.4176 82.2587 27.2337 81.1316 28.7574C80.0044 30.2811 78.6743 31.479 77.2224 32.292C76.9279 32.4569 76.6296 32.6053 76.3281 32.7372L76.0285 32.8683V33.1953V67.7862C76.0285 69.1298 75.6249 70.3266 74.9968 71.1758C74.3685 72.0251 73.5408 72.5005 72.6713 72.5005C71.8019 72.5005 70.9741 72.0251 70.3459 71.1758C69.7178 70.3266 69.3142 69.1298 69.3142 67.7862V33.197V32.8698L69.0144 32.7388C67.2334 31.9606 65.579 30.6118 64.2073 28.7574L63.8092 29.0519L64.2073 28.7574C61.9286 25.6769 60.6337 21.4745 60.6337 17.0718V4.03611C60.6337 3.05232 60.9294 2.18141 61.383 1.56817C61.8367 0.954814 62.4234 0.625397 63.0266 0.625397C63.6298 0.625397 64.2165 0.954814 64.6702 1.56817C65.1238 2.18141 65.4195 3.05232 65.4195 4.03611V17.0718C65.4195 19.5837 66.1564 22.0127 67.4945 23.8215C68.0786 24.6112 68.7593 25.258 69.5067 25.7373ZM98.4346 35.4695V35.1784L98.1815 35.0346C95.998 33.7951 94.1862 31.444 92.9178 28.4595C91.6523 25.4817 90.9476 21.9169 90.9476 18.3173C90.9476 13.797 92.0586 9.3389 93.9889 6.02779C95.9223 2.71112 98.6216 0.625397 101.792 0.625397C104.962 0.625397 107.661 2.71112 109.595 6.02779C111.525 9.3389 112.636 13.797 112.636 18.3173C112.636 21.917 111.931 25.4818 110.666 28.4597C109.398 31.4441 107.586 33.7952 105.402 35.0347L105.149 35.1784V35.4696V67.7862C105.149 69.1301 104.745 70.3269 104.117 71.176C103.489 72.0252 102.661 72.5005 101.792 72.5005C100.922 72.5005 100.095 72.0252 99.4663 71.176C98.8382 70.3269 98.4346 69.1301 98.4346 67.7862V35.4695Z"
                      fill="#CCD5AE"
                      stroke="#CCD5AE"
                    />
                  </g>
                </g>
                <defs>
                  <clipPath id="clip0_1_14">
                    <rect
                      width="54"
                      height="73"
                      fill="white"
                      transform="translate(60)"
                    />
                  </clipPath>
                </defs>
              </svg>

              <XMarkIcon className="hidden h-6 w-6" aria-hidden="true" />
            </DisclosureButton>
          </div>

          <div className="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
            <Link
              to="/"
              className="text-textWhite font-bold text-2xl hidden sm:block"
            >
              GeraMenu
            </Link>
            <div className="hidden sm:ml-6 sm:flex space-x-4">
              <Link to={`/previewext/${userId}`}>Pré-visualização</Link>
              <Link to={`/qr`}>QR Code</Link>
            </div>
          </div>

          {/* Profile dropdown */}
          <div className="absolute inset-y-0 right-0 flex items-center pr-2 sm:ml-4 sm:pr-0">
            <Menu as="div" className="relative ml-3">
              <div>
                <MenuButton className="relative flex rounded-full bg-bgGreen text-sm focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800">
                  <span className="absolute -inset-1.5" />
                  <span className="sr-only">Open user menu</span>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="white"
                    viewBox="0 0 24 24"
                    strokeWidth="1.5"
                    stroke="white"
                    className="size-8"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"
                    />
                  </svg>
                </MenuButton>
              </div>
              <MenuItems
                transition
                className="absolute right-0 z-60 mt-2 w-48 origin-top-right rounded-md bg-bgGreen text-textWhite shadow-lg ring-1 ring-black ring-opacity-2"
              >
                {/* Settings Link */}
                <MenuItem
                  as="a"
                  href="/settings"
                  className="block px-4 py-2 text-sm text-white hover:bg-gray-100"
                >
                  Configurações
                </MenuItem>

                {/* Sign Out Button */}
                <MenuItem
                  as="button"
                  onClick={handleSignOut}
                  className="block w-full px-4 py-2 text-left text-sm text-white hover:bg-gray-100"
                >
                  Sair
                </MenuItem>
              </MenuItems>
            </Menu>
          </div>
        </div>
      </div>

      <DisclosurePanel className="sm:hidden bg-bgGreen">
        <div className="space-y-1 px-2 pb-3 pt-2  bg-bgGreen">
          {navigation.map((item) => (
            <DisclosureButton
              key={item.name}
              as={Link}
              to={item.href}
              className={classNames(
                item.current
                  ? "bg-bgGreen text-white"
                  : "text-gray-300 hover:bg-bgGreen hover:text-white",
                "block rounded-md px-3 py-2 text-base font-medium"
              )}
              aria-current={item.current ? "page" : undefined}
            >
              {item.name}
            </DisclosureButton>
          ))}
        </div>
      </DisclosurePanel>
    </Disclosure>
  );
};

export default Navbar;
